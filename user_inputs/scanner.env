# Scanner configuration (KEY=VALUE)
# Edited via new GUI
# EIDAT_TRENDING_COMBINED_ONLY=1 forces trending extraction to use combined.txt only (skips acceptance)
EIDAT_TRENDING_COMBINED_ONLY=1
QUIET=1
REPO_ROOT=C:\EIDAT PROD TEST\PROGRAM A\EIDAT
OCR_MODE=fallback
OCR_DPI=450
EASYOCR_LANGS=en
OCR_ROW_EPS=33
DEBUG_MODE=1
FUZZY_PRESET=strict
OCR_TESS_PSM=6
SMART_SEC_YPAD=40
TESS_LANG=eng+equ
TESS_OEM=1
TESS_PSM=6
TESS_RETRY_MAX_TOKENS=48
TESS_RETRY_MIN_CONF=0.82
XY_FUZZ=0.00

# === OCR DPI Overrides (migrated from ocr_force.env) ===
# These control the default extraction pipeline DPI knobs.
EIDAT_TABLE_OCR_DPI=450
EIDAT_PAGE_RENDER_DPI=450
EIDAT_TABLE_DETECTION_DPI=900

# === Admin "Process" Overrides (optional) ===
# These are used by the Admin Dashboard when processing nodes.
# Leave as 0/blank to use normal defaults.
#EIDAT_PROCESS_FORCE=0
#EIDAT_PROCESS_LIMIT=0
#EIDAT_PROCESS_DPI=0

# === Fuzzy Header Stick (OFF by default) ===
# When you set a workbook row's `Header` to a long-form column name, allow fuzzy matching
# to abbreviated OCR headers (e.g. "propellant valve resistance" ~= "prop. valve res.").
# This affects ONLY header/column matching; it does NOT change term matching.
EIDAT_FUZZY_HEADER_STICK=0
# Minimum match ratio (0..1). Higher is stricter (fewer false matches).
EIDAT_FUZZY_HEADER_MIN_RATIO=0.72

# === KV Gap Split Heuristic (ON by default) ===
# Converts single-line "Term     Value" (clear horizontal gap) into "Term | Value".
# This helps extract kv_pairs when the line isn't boxed as a table.
# Disable by setting EIDAT_KV_GAP_SPLIT=0
EIDAT_KV_GAP_SPLIT=1

# Merged bundle (eidp_term_scanner.core.py) whitespace-gap threshold.
# Minimum consecutive spaces/tabs required to treat the line as a term/value split.
EIDAT_KV_GAP_MIN_SPACES=8

# Debug exporter (extraction pipeline) token-gap thresholds.
# If the horizontal gap between adjacent tokens exceeds BOTH:
#   - EIDAT_KV_GAP_MIN_PX (absolute pixels)
#   - (line_height * EIDAT_KV_GAP_H_MULT)
# then the line is rendered as "Term | Value".
EIDAT_KV_GAP_MIN_PX=0
EIDAT_KV_GAP_H_MULT=2.5

# Table clustering gap control for bordered tables (lower = less merging across white gaps)
# Effective gap threshold (in detection-DPI pixels):
#   gap = max(page_w, page_h) * EIDAT_TABLE_CLUSTER_GAP_RATIO
#   if EIDAT_TABLE_CLUSTER_GAP_PX > 0: gap = min(gap, EIDAT_TABLE_CLUSTER_GAP_PX)
EIDAT_TABLE_CLUSTER_GAP_RATIO=0.005
EIDAT_TABLE_CLUSTER_GAP_PX=25

# Table splitting for stacked tables with mismatched internal vertical gridlines.
# The extractor will split a detected table whenever per-row internal vertical boundaries
# differ by more than this tolerance (in detection-DPI pixels). Lower = more splitting.
EIDAT_TABLE_SPLIT_VLINE_MISALIGN_PX=20

# Table post-processing mode:
# - vline   (default): split stacked tables using the vline-mismatch heuristic
# - replica: do NOT split; instead render ASCII tables using snapped bbox gridlines (more faithful layout)
# - none    : do NOT split; keep default ASCII renderer
EIDAT_TABLE_SPLIT_MODE=replica

# Combined.txt table splitting (ASCII-only; no additional OCR):
# - inherit (default): follow EIDAT_TABLE_SPLIT_MODE
# - vline           : apply vline-mismatch splitting when writing combined.txt (recommended with replica)
EIDAT_COMBINED_TABLE_SPLIT_MODE=vline
# Optional overrides for combined.txt splitting (defaults fall back to the table-split envs):
#EIDAT_COMBINED_TABLE_SPLIT_VLINE_MISALIGN_PX=20
#EIDAT_COMBINED_TABLE_SPLIT_VLINE_MIN_RUN=2
#EIDAT_COMBINED_TABLE_SPLIT_SINGLE_CELL_SEPARATOR=1
#EIDAT_COMBINED_TABLE_SPLIT_SINGLE_CELL_SEPARATOR_MAX_H_RATIO=0.45

# Optional: require a mismatch to persist for N rows before splitting.
# Helps avoid over-splitting from a single bad/merged row. (1 = current/most sensitive)
#EIDAT_TABLE_SPLIT_VLINE_MIN_RUN=2
#
# Optional: control the special "single-cell separator row" split.
# By default, a 1-cell row between multi-cell regions can be treated as a separator and split out.
# If you have legit header/colspan rows, consider either disabling or enabling the height filter.
#EIDAT_TABLE_SPLIT_SINGLE_CELL_SEPARATOR=1
# Only split a 1-cell separator row if its row height <= (median multi-cell row height * ratio).
# 0 disables the height filter (current behavior).
#EIDAT_TABLE_SPLIT_SINGLE_CELL_SEPARATOR_MAX_H_RATIO=0.45

# Replica ASCII renderer snapping (used when EIDAT_TABLE_SPLIT_MODE=replica).
#EIDAT_TABLE_ASCII_MAX_WIDTH=160
# Absolute snapping tolerance in detection-DPI pixels (0 = auto).
#EIDAT_TABLE_ASCII_SNAP_TOL_PX=0
# Auto tolerance = min(min(table_w, table_h) * ratio, max_px), with a 2px floor.
# EIDAT_TABLE_ASCII_SNAP_TOL_RATIO=0.006
EIDAT_TABLE_ASCII_SNAP_MAX_PX=15

# === Faint/Thin Line Help (Bordered Tables) ===
# If table borders are too faint for bordered-cell detection, try either:
#  1) Enable borderless table detection (token-grid; does not rely on drawn lines), OR
#  2) Increase sensitivity of the bordered line/cell detector.
#
# Option 1 (recommended fallback when borders are unreliable):
#EIDAT_TABLE_ENABLE_BORDERLESS=1
#
# Option 2 (bordered detector sensitivity):
# - Raise BIN_HIGH_THRESH to include lighter gray strokes (default 200).
# - Increase dilation to connect broken strokes.
# - Enable CLAHE to boost local contrast on washed-out scans.
#EIDAT_TABLE_DETECT_BIN_HIGH_THRESH=230
#EIDAT_TABLE_DETECT_ADAPT_BLOCK=25
#EIDAT_TABLE_DETECT_ADAPT_C=8
#EIDAT_TABLE_DETECT_H_DILATE_W=7
#EIDAT_TABLE_DETECT_H_DILATE_H=3
#EIDAT_TABLE_DETECT_V_DILATE_W=3
#EIDAT_TABLE_DETECT_V_DILATE_H=7
#EIDAT_TABLE_DETECT_GRID_DILATE=3
#EIDAT_TABLE_DETECT_CONTOUR_FILL_MIN=0.65
#EIDAT_TABLE_DETECT_CLAHE=1
#EIDAT_TABLE_DETECT_CLAHE_CLIP=2.0
#EIDAT_TABLE_DETECT_CLAHE_TILE=16
# Optional denoise (can hurt very thin lines if set too high):
#EIDAT_TABLE_DETECT_BLUR_K=0
